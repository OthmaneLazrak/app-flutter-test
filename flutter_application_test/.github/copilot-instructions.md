## Project quick context

- Flutter app (Dart) using Firebase services (Auth, Firestore, Storage, etc.). Initialize Firebase in `lib/main.dart` via `Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform)` — `firebase_options.dart` is generated by FlutterFire CLI and required to run.
- Screens are under `lib/screens/` (notably: `login.page.dart`, `register.page.dart`, `home.page.dart`). App routes: `/login`, `/home`, `/register` are defined in `lib/main.dart`.
- Authentication uses `firebase_auth` package. Sign-up uses `createUserWithEmailAndPassword` and (should) set `displayName` via `user.updateDisplayName(...)`; login uses `signInWithEmailAndPassword`.

## What this app expects from AI agents

- Keep changes localized to `lib/screens/` unless asked to update project-wide patterns.
- When fixing UI/UX issues, look for similar patterns in both `login.page.dart`, `register.page.dart` and `home.page.dart` — the app uses consistent `InputDecorationTheme` and styling across pages.
- Auth patterns: prefer `FirebaseAuth.instance.authStateChanges()` and `FirebaseAuth.instance.currentUser` to read user data. When updating authentication flows, ensure the UI uses these signals so changes reflect immediately.

## Key files & patterns

- `lib/main.dart` — Firebase initialization, theming, and route table. Keep route keys unchanged (`/login`, `/home`, `/register`) unless updating multiple components.
- `lib/screens/register.page.dart` — register flow: validates forms and currently uses `createUserWithEmailAndPassword`. If you set `displayName`, call `updateDisplayName` and `reload()` on the user. Avoid duplicate navigation and ensure form validation runs before calling `createUserWithEmailAndPassword`.
- `lib/screens/login.page.dart` — sign-in flow: defined `Signin()` which performs Firebase sign-in. Prefer calling the method from the button handler (it also handles errors & navigation).
- `lib/screens/home.page.dart` — app UI and `Drawer` header. Use `FirebaseAuth.instance.currentUser` (or listen to `authStateChanges`) to show dynamic `displayName` and `email`. Use `FirebaseAuth.instance.signOut()` for logout.

## Dev workflows / commands

- Run app (Chrome):
  flutter run -d chrome
- Run app (Android/iOS):
  flutter run -d <device id>
- Make sure to run `flutter pub get` and have `firebase_options.dart` configured before running.

## Conventions & pitfalls

- Stack vs SingleChildScrollView: pages use `SingleChildScrollView` with `ConstrainedBox` to keep layout scrollable while filling the screen. Re-use this pattern for long pages.
- Navigation: app prefers `Navigator.pushReplacementNamed` for moving to `/home` after successful auth. Review callbacks and avoid redundant calls to `Navigator` outside sign-in/up success handlers.
- Styling: Colors and UI themes are centralized in `main.dart` ThemeData; avoid hardcoding colors when adding components.
- State patterns: many pages are `StatefulWidget`s to hold animation/visibility booleans (like `passwordVisible`). Use `authStateChanges()` to keep drawer/user info reactive.

## When writing code or PRs

- Keep diffs focused: changing auth flows may require updating login/register/home files and tests.
- Add unit/UI tests when modifying form validation or navigation.
- Mention in PR body if changes require updating `firebase_options.dart` (project-specific) or Firebase console (e.g., enabling email/password auth).

## Example: Make Drawer header dynamic

 - Source of truth: `FirebaseAuth.instance.currentUser.displayName` and `.email`.
 - Implement pattern: (a) Convert `HomePage` to a `StatefulWidget`, (b) set `_user = FirebaseAuth.instance.currentUser;`, (c) listen to `authStateChanges()` and update state, (d) use `_user?.displayName ?? 'Nom non défini'` and `_user?.email` in `DrawerHeader`.

## Notes for AI reviewers

- If you find navigation or auth logic that bypasses sign-in/validation (see previous `Navigator.pushNamed(context, '/home');` in `login.page.dart`), fix by calling the `Signin` method and checking the login success path.
- Avoid changing routes or route names unless required and coordinated across files.

If anything is unclear or you'd like me to add examples for a specific component (e.g., Firestore user profile sync or saving avatar photos), tell me which area to expand. 
